
{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Factura_{{ pedido.id }}</title>
    <style>
        body { font-family: 'Segoe UI', Arial, sans-serif; color: #333; background-color: #F5F8F9; margin: 0; padding: 20px; }
        .invoice-box {
            max-width: 800px; margin: auto; padding: 30px;
            background-color: #F3FDFE; border: 1px solid #AFD6F8;
            border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.05);
        }
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 3px solid #9BC7EC; padding-bottom: 15px; margin-bottom: 20px; }
        .logo { width: 100px; height: auto; }
        
        .details-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px; }
        .card { background: #E2F1F7; padding: 15px; border-radius: 5px; border-left: 4px solid #7FC6D7; }
        .card h4 { margin: 0 0 10px 0; color: #7FC6D7; font-size: 14px; text-transform: uppercase; }

        table { width: 100%; border-collapse: collapse; margin-bottom: 20px; background: white; }
        table th { background: #9BC7EC; color: white; padding: 10px; text-align: left; }
        table td { padding: 10px; border-bottom: 1px solid #CEEAF6; }

        .totals-container { margin-left: auto; width: 250px; }
        .total-row { display: flex; justify-content: space-between; padding: 5px 0; }
        .grand-total { border-top: 2px solid #7FC6D7; margin-top: 10px; padding-top: 10px; font-weight: bold; color: #7FC6D7; font-size: 18px; }

        .no-print { text-align: center; margin-top: 30px; }
        .btn { background: #9BC7EC; color: white; padding: 10px 20px; text-decoration: none; border-radius: 5px; border: none; cursor: pointer; }
        
        @media print { .no-print { display: none; } .invoice-box { border: none; box-shadow: none; } body { background: white; padding: 0; } }
    </style>
</head>
<body onload="window.print()">

    <div class="invoice-box">
        <div class="header">
            <div style="display: flex; align-items: center; gap: 15px;">
                <img src="{% static 'css/img/sky1.png' %}" alt="Logo" class="logo">
                <div>
                    <h2 style="margin:0; color: #7FC6D7;">MI TIENDA S.A.</h2>
                    <small>RUC: 1790000000001</small>
                </div>
            </div>
            <div style="text-align: right;">
                <h2 style="margin:0; color: #9BC7EC;">FACTURA DIGITAL</h2>
                <strong>Orden: #00{{ pedido.id }}</strong><br>
                <small>Fecha: {{ pedido.fecha|date:"d/m/Y H:i" }}</small>
            </div>
        </div>

        <div class="details-grid">
            <div class="card">
                <h4>Cliente</h4>
                <strong>{{ pedido.cliente.username }}</strong><br>
                {{ pedido.cliente.email }}
            </div>
            <div class="card">
                <h4>Datos de Entrega</h4>
                <strong>Direcci√≥n:</strong> {{ pedido.direccion_envio }}<br>
                <strong>Estado:</strong> {{ pedido.estado }}
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th>Producto</th>
                    <th style="width: 50px;">Cant.</th>
                    <th>Precio Unit.</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for item in pedido.items.all %}
                <tr>
                    <td>{{ item.producto.nombre }}</td>
                    <td>{{ item.cantidad }}</td>
                    <td>${{ item.precio_unitario }}</td>
                    <td>${{ item.subtotal_linea|floatformat:2 }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <div class="totals-container">
            <div class="total-row"><span>Subtotal:</span><span>${{ pedido.subtotal|floatformat:2 }}</span></div>
            <div class="total-row"><span>Descuento:</span><span>-${{ pedido.descuento|floatformat:2 }}</span></div>
            <div class="total-row"><span>IVA ({{ pedido.iva_aplicado }}%):</span><span>${{ iva_total|floatformat:2 }}</span></div>
            <div class="total-row grand-total"><span>TOTAL:</span><span>${{ pedido.total|floatformat:2 }}</span></div>
        </div>
    </div>

    <div class="no-print">
        <button onclick="window.print()" class="btn">Imprimir / Guardar PDF</button>
        <a href="{% url 'catalogo_publico' %}" class="btn" style="background:#AFD6F8; margin-left:10px;">Volver a la Tienda</a>
    </div>

</body>
</html>